# MELHORIA-2: Solicitar Contexto em Perguntas sobre Reuni√µes Espec√≠ficas

## üìã Resumo Executivo
Este documento detalha como melhorar a intera√ß√£o do sistema quando usu√°rios perguntam genericamente sobre reuni√µes espec√≠ficas, solicitando mais contexto antes de fornecer uma resposta completa.

## üî¥ PROBLEMA: Respostas Gen√©ricas sobre Reuni√µes Espec√≠ficas

### Exemplos do Problema:

**Situa√ß√£o 1 - Pergunta sobre reuni√£o sem especificar o que quer saber:**
```
USU√ÅRIO: "Me fale sobre a reuni√£o de ontem"
SISTEMA ATUAL: [Despeja todas as informa√ß√µes dispon√≠veis sobre a reuni√£o]
SISTEMA IDEAL: "Encontrei a reuni√£o de ontem. O que voc√™ gostaria de saber especificamente?
- Um resumo geral
- Os principais pontos discutidos
- As decis√µes tomadas
- Os participantes
- Os pr√≥ximos passos definidos"
```

**Situa√ß√£o 2 - Pergunta vaga sobre reuni√£o espec√≠fica:**
```
USU√ÅRIO: "O que teve na reuni√£o de vendas?"
SISTEMA ATUAL: [Retorna todo o conte√∫do dispon√≠vel]
SISTEMA IDEAL: "Sobre a reuni√£o de vendas, voc√™ gostaria de saber:
- Os resultados apresentados?
- As metas discutidas?
- Os problemas identificados?
- O plano de a√ß√£o definido?"
```

**Situa√ß√£o 3 - Refer√™ncia a reuni√£o por t√≠tulo:**
```
USU√ÅRIO: "Me conte sobre a reuni√£o RAPADURA"
SISTEMA ATUAL: [Retorna todos os chunks relacionados]
SISTEMA IDEAL: "Encontrei a reuni√£o RAPADURA. Como posso ajud√°-lo melhor?
- Precisa de um resumo executivo?
- Quer saber sobre algum t√≥pico espec√≠fico?
- Interessado nas decis√µes e a√ß√µes?
- Ou prefere a transcri√ß√£o completa?"
```

### Por que isso √© um problema?
1. **Sobrecarga de Informa√ß√£o**: O usu√°rio recebe muito mais informa√ß√£o do que precisa
2. **Inefici√™ncia**: Gasta tokens e tempo processando informa√ß√µes desnecess√°rias
3. **Experi√™ncia Ruim**: O usu√°rio precisa filtrar mentalmente o que √© relevante
4. **Falta de Personaliza√ß√£o**: N√£o atende √† necessidade espec√≠fica do usu√°rio

## üîç C√≥digo Atual Causando o Problema:

```python
# Em agente_busca_melhorado.py, m√©todo processar_pergunta()
# O sistema n√£o verifica se a pergunta √© sobre uma reuni√£o espec√≠fica mas gen√©rica

def processar_pergunta(self, pergunta: str) -> str:
    # ... c√≥digo anterior ...
    
    # VAI DIRETO BUSCAR CHUNKS SEM PERGUNTAR O QUE O USU√ÅRIO QUER
    chunks_relevantes = self.buscar_chunks_relevantes(pergunta, num_resultados=5)
    
    # E ENT√ÉO GERA RESPOSTA COM TUDO QUE ENCONTROU
    resposta = self._gerar_resposta(pergunta, contexto, contexto_memoria)
```

## ‚úÖ Solu√ß√£o Conservadora Proposta:

### 1. Adicionar Detec√ß√£o de Perguntas sobre Reuni√µes Espec√≠ficas:

```python
def _e_pergunta_sobre_reuniao_especifica(self, pergunta: str) -> tuple[bool, str]:
    """
    Detecta se a pergunta √© sobre uma reuni√£o espec√≠fica mas sem detalhar o que quer saber
    Retorna: (√©_sobre_reuni√£o, nome_poss√≠vel_reuni√£o)
    """
    pergunta_lower = pergunta.lower()
    
    # Padr√µes que indicam pergunta sobre reuni√£o espec√≠fica
    padroes_reuniao = [
        r'me (?:fale|conte|diga) sobre a reuni[√£a]o (?:de |do |da )?(.+)',
        r'o que (?:teve|houve|aconteceu) na reuni[√£a]o (?:de |do |da )?(.+)',
        r'(?:sobre|qual foi) a reuni[√£a]o (?:de |do |da )?(.+)',
        r'reuni[√£a]o (?:de |do |da )?(.+?)(?:\?|$)',
        r'me (?:fale|conte) (?:sobre|da) (.+)' # Para casos como "me fale sobre RAPADURA"
    ]
    
    # Termos que indicam aspecto espec√≠fico (n√£o precisa solicitar contexto)
    aspectos_especificos = [
        'resumo', 'principais pontos', 'decis√µes', 'participantes',
        'a√ß√µes', 'pr√≥ximos passos', 'problemas', 'riscos', 'data',
        'hor√°rio', 'dura√ß√£o', 'respons√°vel', 'pauta'
    ]
    
    # Verifica se j√° est√° pedindo algo espec√≠fico
    for aspecto in aspectos_especificos:
        if aspecto in pergunta_lower:
            return False, ""
    
    # Verifica padr√µes de reuni√£o
    import re
    for padrao in padroes_reuniao:
        match = re.search(padrao, pergunta_lower)
        if match:
            possivel_reuniao = match.group(1) if match.groups() else ""
            # Verifica se n√£o √© muito gen√©rico
            if possivel_reuniao and len(possivel_reuniao.split()) <= 3:
                return True, possivel_reuniao.strip()
    
    return False, ""
```

### 2. Adicionar Gera√ß√£o de Op√ß√µes Contextuais:

```python
def _gerar_opcoes_contexto_reuniao(self, nome_reuniao: str = "") -> str:
    """Gera op√ß√µes de contexto para o usu√°rio escolher"""
    intro = f"Encontrei informa√ß√µes sobre "
    if nome_reuniao:
        intro += f"a reuni√£o '{nome_reuniao}'. "
    else:
        intro += "essa reuni√£o. "
    
    opcoes = """O que voc√™ gostaria de saber especificamente?

‚Ä¢ **Resumo geral** - Vis√£o executiva dos principais t√≥picos
‚Ä¢ **Pontos discutidos** - Detalhamento dos assuntos abordados  
‚Ä¢ **Decis√µes tomadas** - A√ß√µes e delibera√ß√µes definidas
‚Ä¢ **Participantes** - Quem esteve presente
‚Ä¢ **Pr√≥ximos passos** - Tarefas e prazos estabelecidos
‚Ä¢ **Problemas identificados** - Quest√µes e riscos levantados
‚Ä¢ **Transcri√ß√£o completa** - Todo o conte√∫do dispon√≠vel

Por favor, especifique o que mais lhe interessa."""
    
    return intro + opcoes
```

### 3. Modificar o Processamento Principal:

```python
def processar_pergunta(self, pergunta: str) -> str:
    print(f"Processando pergunta: {pergunta}")
    
    # ... c√≥digo de sauda√ß√µes ...
    
    # NOVO: Verificar ambiguidade primeiro
    if self._e_pergunta_ambigua(pergunta):
        # ... c√≥digo existente de ambiguidade ...
    
    # NOVO: Verificar se √© pergunta sobre reuni√£o espec√≠fica mas gen√©rica
    e_sobre_reuniao, nome_reuniao = self._e_pergunta_sobre_reuniao_especifica(pergunta)
    if e_sobre_reuniao:
        # Fazer busca r√°pida para confirmar que a reuni√£o existe
        chunks_teste = self.buscar_chunks_relevantes(pergunta, num_resultados=1)
        
        if chunks_teste:
            # Reuni√£o encontrada - solicitar contexto
            resposta = self._gerar_opcoes_contexto_reuniao(nome_reuniao)
            self.gerenciador_memoria.processar_interacao(pergunta, resposta)
            return resposta
        else:
            # Reuni√£o n√£o encontrada - continuar fluxo normal
            pass
    
    # Continua processamento normal...
```

### 4. Exemplo de Implementa√ß√£o Completa:

```python
# Inserir ap√≥s a fun√ß√£o _e_pergunta_generica() (por volta da linha 455)

def _e_pergunta_sobre_reuniao_especifica(self, pergunta: str) -> tuple[bool, str]:
    """Detecta perguntas gen√©ricas sobre reuni√µes espec√≠ficas"""
    import re
    
    pergunta_lower = pergunta.lower()
    
    # Padr√µes comuns
    padroes_reuniao = [
        r'me (?:fale|conte|diga) sobre a reuni[√£a]o (?:de |do |da )?(.+)',
        r'o que (?:teve|houve|aconteceu) na reuni[√£a]o (?:de |do |da )?(.+)',
        r'(?:sobre|qual foi) a reuni[√£a]o (?:de |do |da )?(.+)',
    ]
    
    # Se j√° pede algo espec√≠fico, n√£o precisa contexto
    if any(termo in pergunta_lower for termo in ['resumo', 'decis√µes', 'participantes']):
        return False, ""
    
    for padrao in padroes_reuniao:
        match = re.search(padrao, pergunta_lower)
        if match and match.groups():
            return True, match.group(1).strip()
    
    return False, ""

def _gerar_opcoes_contexto_reuniao(self, nome_reuniao: str = "") -> str:
    """Gera menu de op√ß√µes para reuni√£o"""
    return f"""Certo, sobre a reuni√£o{f' "{nome_reuniao}"' if nome_reuniao else ''}. 
O que voc√™ gostaria de saber?

‚Ä¢ **Resumo geral** - Principais pontos em formato executivo
‚Ä¢ **Discuss√µes detalhadas** - Todos os t√≥picos abordados
‚Ä¢ **Decis√µes e a√ß√µes** - O que foi definido
‚Ä¢ **Participantes** - Quem estava presente
‚Ä¢ **Pr√≥ximos passos** - Tarefas e respons√°veis

Especifique sua necessidade para uma resposta mais precisa."""
```

## üìä Compara√ß√£o Antes x Depois

| Aspecto | ANTES | DEPOIS |
|---------|-------|--------|
| Intera√ß√£o | Uma pergunta ‚Üí Resposta completa | Uma pergunta ‚Üí Solicita contexto ‚Üí Resposta focada |
| Tokens usados | Alto (resposta completa sempre) | Otimizado (s√≥ o necess√°rio) |
| Experi√™ncia | Sobrecarga de informa√ß√£o | Resposta personalizada |
| Efici√™ncia | Baixa | Alta |

## üéØ Benef√≠cios da Solu√ß√£o

1. **Melhor UX**: Usu√°rio recebe exatamente o que precisa
2. **Economia de Tokens**: Reduz custos ao evitar respostas desnecess√°rias
3. **Intera√ß√£o Natural**: Simula um assistente humano que pergunta para entender melhor
4. **Flexibilidade**: Usu√°rio pode escolher n√≠vel de detalhe desejado

## üí° Observa√ß√µes Finais

Esta solu√ß√£o:
- **√â conservadora**: Adiciona apenas ~50 linhas de c√≥digo
- **√â n√£o-invasiva**: N√£o quebra funcionalidades existentes
- **√â extens√≠vel**: F√°cil adicionar mais padr√µes e op√ß√µes
- **√â test√°vel**: Fun√ß√µes isoladas facilitam testes unit√°rios

Total de c√≥digo a adicionar: ~50 linhas
Complexidade: Baixa
Risco: M√≠nimo